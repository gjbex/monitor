Bootstrap: docker
From: docker.io/python:3.8-slim

%labels
    Maintainer Geert Jan Bex
    Institute Vlaams Supercomputer Centrum

%files
    scripts/monitor.py /bin/monitor
    scripts/find_pids.py /bin/find_pids
    scripts/monitor_lib.py /usr/local/lib/monitor/

%post
    chmod a+x /bin/monitor
    chmod a+x /bin/find_pids

%post                                                      
    apt-get update -y                                      
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
                    openssh-client
    rm -rf /var/lib/apt/lists/*

%environment
    export PYTHONPATH=/usr/local/lib/monitor

%post
    pip install psutil

%post
    chmod a+rx /bin/monitor

# monitor app
%apprun monitor
    /bin/monitor "$@"

%applabels monitor
    BESTAPP MONITOR

%apphelp monitor
    run monitor

# find_pids app
%apprun find_pids
    /bin/find_pids "$@"

%applabels find_pids
    BESTAPP FIND_PIDS

%apphelp find_pids
    run find_pids
